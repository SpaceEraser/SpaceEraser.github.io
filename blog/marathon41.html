---
program_dividers: [6, 10, 16, 20, 28]
program:
  - ["core & yoga", "-", ["5w","5x3w/1r","5w"], "core", ["5w","5x3w/1r","5w"], "-", ["5w","5x2.5w","1.5r/5w"]]
  - ["core & yoga", "-", ["4w","5x2.5w/1.5r","4w"], "core", ["4w","5x2w/2r","4w"], "-", ["4w","3x2W/2R","1x3w/6r","4w"]]
  - ["core & yoga", "-", ["4w","6x2w/2r","4w"], "core", ["4W","6x1.5w/2.5r","4W"], "-", ["4W","2km","4W"]]
  - ["core & yoga", "-", ["4R","6x1.5w/2.5r","4W"], "core", ["4R","6x1w/3r","4W"], "-", ["4W","3km","4W"]]
  - ["core & yoga", "-", ["5R","4x1w/5r","5W"], "core", ["5R","4x1w/7r","5W"], "-", ["4W","4km","4W"]]
  - ["core & yoga", "-", ["5R","5x1w/7r","5W"], "core", ["5R","3x1w/10r","5W"], "-", "5km"]
  - ["yoga", "3km", "3km", "yoga", "3km", "-", "3km"]
  - ["yoga", "3km", "3km", "yoga", "3km", "-", "4km"]
  - ["yoga", "3km", "3km", "yoga", "4km", "-", "5km"]
  - ["yoga", "2km", "2km", "yoga", "2km", "-", "3km"]
  - ["core & yoga", "4km", "4km", "core", "3km", "-", "4km"]
  - ["core & yoga", "4km", "4km", "core", "4km", "-", "5km"]
  - ["core & yoga", "20:00 intervals", "5km", "core", "5km", "-", "6km"]
  - ["core & yoga", "30:00 intervals", "6km", "core", "6km", "-", "7km"]
  - ["core & yoga", "40:00 intervals", "7km", "core", "6km", "-", "8km"]
  - ["core & yoga", "5km", "20:00 intervals", "core", "20:00 intervals", "-", "10km"]
  - ["yoga", "6km", "6km", "yoga", "6km", "-", "6km"]
  - ["yoga", "6km", "6km", "yoga", "7km", "-", "8km"]
  - ["yoga", "7km", "7km", "yoga", "8km", "-", "6km"]
  - ["yoga", "5km", "5km", "yoga", "5km", "-", "5km"]
  - ["core & yoga", "10km", "-", "core", "10km", "-", "10km"]
  - ["core & yoga", "10km", "-", "core", "10km", "-", "12km"]
  - ["core & yoga", "10km", "-", "core", "11km", "-", "14km"]
  - ["core & yoga", "5km", "-", "core", "5km", "-", "7km"]
  - ["core & yoga", "10km", "30:00 intervals", "core", "12km", "-", "14km"]
  - ["core & yoga", "10km", "40:00 intervals", "core", "13km", "-", "16km"]
  - ["core & yoga", "10km", "50:00 intervals", "core", "14km", "-", "18km"]
  - ["yoga", "5km", "-", "yoga", "20:00 intervals", "-", "21.1km"]
  - ["core & yoga", "10km", "10km", "core", "12km", "-", "14km"]
  - ["core & yoga", "10km", "10km", "core", "12km", "-", "16km"]
  - ["core & yoga", "10km", "10km", "core", "12km", "-", "18km"]
  - ["core & yoga", "5km", "5km", "core", "5km", "-", "9km"]
  - ["core & yoga", "12km", "12km", "core", "12km", "-", "22km"]
  - ["core & yoga", "12km", "12km", "core", "12km", "-", "25km"]
  - ["core & yoga", "12km", "12km", "core", "12km", "-", "27km"]
  - ["yoga", "6km", "6km", "yoga", "6km", "-", "14km"]
  - ["core & yoga", "10km", "10km", "core", "12km", "-", "31km"]
  - ["core & yoga", "10km", "10km", "core", "12km", "-", "33km"]
  - ["core & yoga", "10km", "10km", "core", "10km", "-", "35km"]
  - ["yoga", "-", "7km", "yoga", "7km", "-", "12km"]
  - ["yoga", "-", "4km", "yoga", "3km", "-", "42.2km"]
---
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    table {
      border-collapse: collapse;
    }
    table thead tr:nth-child(1) {
      background: white;
      position: sticky;
      top: 0;
    }
    table tbody tr td {
      vertical-align: middle;
    }
    .this-week {
      background-color: rgba(0, 0, 0, 0.25);
    }
    .today {
      background-color: rgba(0, 0, 0, 0.5) !important;
      color: white;
    }
  </style>

  <title>Marathon 41</title>
</head>

<body>
  <script src="https://code.jquery.com/jquery-3.6.0.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
  <div class="container-md mb-3">
    <div class="row">
      <div class="col-12 text-center">
        <h1 class="mt-2">Marathon 41</h1>
      </div>
    </div>
    <div class="row">
      <div class="col-12">
        <form action="javascript:void(0);">
          <div class="form-group d-flex">
            <label for="date" class="col-form-label text-end me-2">Race&nbsp;Date (week&nbsp;of)</label>
            <div class="flex-grow-1">
              <input id="date" name="date" type="date" class="form-control">
            </div>
          </div>
        </form>
      </div>
    </div>
    <div class="row">
      <div class="col-12">
        <table class="table table-bordered table-sm text-center mt-4"
          data-toggle="table" data-sticky-header="true">
          <thead>
            <tr>
              <th scope="col">Week</th>
              <th scope="col">Monday</th>
              <th scope="col">Tuesday</th>
              <th scope="col">Wednesday</th>
              <th scope="col">Thursday</th>
              <th scope="col">Friday</th>
              <th scope="col">Saturday</th>
              <th scope="col">Sunday</th>
            </tr>
          </thead>
          <tbody>
            {%- assign week_num = 1 -%}
            {% for week in page.program -%}
              <tr {%- for divider in page.program_dividers -%}{%- if divider == week_num %} style="border-bottom: solid 2px;"{%- endif -%}{%- endfor -%}>
                <td>#{{ week_num }}</td>
                {%- for day in week -%}
                <td>
                  {%- if day[0] -%}
                    {%- for part in day -%}
                      {{- part | downcase -}}<br/>
                    {%- endfor -%}
                  {%- else -%}
                    {{- day | downcase -}}
                  {%- endif -%}
                </td>
                {%- endfor -%}
              </tr>
              {%- assign week_num = week_num | plus: 1 -%}
            {% endfor %}
        </table>
      </div>
    </div>
    <div class="row">
      <div class="col-lg-3 col-md-6 mb-2">
        <div class="card" id="intervals-20">
          <div class="card-body">
            <h5 class="card-title">20:00 intervals</h5>
          </div>
          <ul class="list-group list-group-flush">
            <li class="list-group-item">5 MINUTE EASY JOG WARM UP</li>
            <li class="list-group-item">10 X 30 SECONDS HARD RUNNING / 30 SECONDS SLOW JOG OR WALK</li>
            <li class="list-group-item">5 MINS EASY COOL DOWN</li>
          </ul>
        </div>
      </div>
      <div class="col-lg-3 col-md-6 mb-2">
        <div class="card" id="intervals-30">
          <div class="card-body">
            <h5 class="card-title">30:00 intervals</h5>
          </div>
          <ul class="list-group list-group-flush">
            <li class="list-group-item">1KM EASY JOG WARM UP</li>
            <li class="list-group-item">5 X 30S EASY/20S TEMPO/10S HARD</li>
            <li class="list-group-item">2 MINS WALK</li>
            <li class="list-group-item">5 X 30S EASY/20S TEMPO/ 10S HARD</li>
            <li class="list-group-item">2 MINS WALK</li>
            <li class="list-group-item">5 X 30S EASY/20S TEMPO/ 10S HARD</li>
            <li class="list-group-item">2 MINS WALK</li>
            <li class="list-group-item">1KM COOL DOWN EASY JOG</li>
          </ul>
        </div>
      </div>  
      <div class="col-lg-3 col-md-6 mb-2">
        <div class="card" id="intervals-40">
          <div class="card-body">
            <h5 class="card-title">40:00 intervals</h5>
          </div>
          <ul class="list-group list-group-flush">
            <li class="list-group-item">10 MINUTE EASY JOG WARM UP</li>
            <li class="list-group-item">5 X 3 MINS HARD RUN / 1 MINS SLOW JOG OR WALK</li>
            <li class="list-group-item">10 MINS EASY JOG WALK COOL DOWN</li>
          </ul>
        </div>
      </div>
      <div class="col-lg-3 col-md-6 mb-2">
        <div class="card" id="intervals-50">
          <div class="card-body">
            <h5 class="card-title">50:00 intervals</h5>
          </div>
          <ul class="list-group list-group-flush">
            <li class="list-group-item">10 MINS EASY JOG WARM UP</li>
            <li class="list-group-item">4 X 5 MINS AT TEMPO (7 OR 8/10 RPE) WITH 2.5MINS RECOVERY BETWEEN EACH</li>
            <li class="list-group-item">10 MINS EASY JOG COOL DOWN</li>
          </ul>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-12">
        <pre>
          TODO: link to pace equivalency calculator for 5km (hard running) time
          (ex: https://lukehumphreyrunning.com/hmmcalculator/race_equivalency_calculator.php)
        </pre>
        <pre>
          TODO: link intervals to cards
        </pre>
        <pre>
          TODO: Add non-negotiables:
          1. STRETCH AFTER EVERY SESSION
          2. DON'T NEGLECT STRENGTH AND CONDITIONING
          3. RESPECT THE REST & RECOVERY
          4. ENJOY IT 
        </pre>
      </div>
    </div>
  </div>
  <script>
    $(function() {
      let date_cookie = getCookie("date");
      let date = null;

      if (date_cookie) {
        $('#date').val(date_cookie);
        date = deserializeDate(date_cookie);
        updateHighlight(date);
      }

      $('#date').on('change', function() {
        const date_str = $(this).val();
        setCookie("date", date_str, 365*5); // store for 5 years
        date = deserializeDate(date_str);
        updateHighlight(date);
      });

      setInterval(function () {
        updateHighlight(date);
      }, 1000 * 60 * 60); // repeat every hour
    });

    // function formatTime(seconds) {
    //   const h = Math.floor(seconds / 3600);
    //   const m = Math.floor((seconds % 3600) / 60);
    //   const s = Math.round(seconds % 60);
    //   return [
    //     h,
    //     m > 9 ? m : (h ? '0' + m : m || '0'),
    //     s > 9 ? s : '0' + s
    //   ].filter(Boolean).join(':');
    // }

    function updateHighlight(date) {
      $(".today, .this-week").removeClass("today").removeClass("this-week");
      
      if (!(date instanceof Date)) {
        return;
      } 

      const now = new Date();
      const program_num_weeks = $("table tbody tr").length;
      const next_monday_after_date = addDays(date, 7 - mod(date.getDay()-1, 7));
      const program_start_ts = next_monday_after_date.getTime() - (program_num_weeks * 1000 * 60 * 60 * 24 * 7);
      const elapsed_days = (now.getTime() - program_start_ts) / (1000 * 60 * 60 * 24);
      const elapsed_weeks = Math.ceil(elapsed_days / 7);
      const elapsed_dow = Math.floor(elapsed_days) % 7;

      if (elapsed_days < 0 || elapsed_weeks > program_num_weeks) {
        return;
      }

      const $this_week = $(`table tbody tr:nth-child(${elapsed_weeks})`).addClass("this-week");
      $this_week.find(`td:nth-child(${elapsed_dow+2})`).addClass("today");
    }

    function mod(v, m) {
      return ((v % m) + m) % m;
    }

    function addDays(date, days) {
      var result = new Date(date);
      result.setDate(result.getDate() + days);
      return result;
    }

    function deserializeDate(str) {
      const [year, month, date] = str.split("-");
      return new Date(year, month - 1, date);
    }

    function setCookie(cname, cvalue, exdays) {
      const d = new Date();
      d.setTime(d.getTime() + (exdays*24*60*60*1000));
      let expires = "expires="+ d.toUTCString();
      document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
    }

    function getCookie(cname) {
      let name = cname + "=";
      let decodedCookie = decodeURIComponent(document.cookie);
      let ca = decodedCookie.split(';');
      for(let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) == ' ') {
          c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
          return c.substring(name.length, c.length);
        }
      }
      return null;
    }
  </script>
</body>

</html>